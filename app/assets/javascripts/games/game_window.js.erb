'use strict';      

      function init() {

        actionService.init(window);
        var stage = new createjs.Stage("main");

        var canvas = stage.canvas

        var world = new createjs.Container();
        world.x = 0
        world.y = 0
        stage.addChild(world)

        var grid = new Grid(20, 20);
        grid.x = 0
        grid.y = 0
        grid.width = (grid.gridRows)*80;
        grid.height = (grid.columns)*80;
        world.addChildAt(grid, 0)

        sidewinder(grid);

        var FLOOR,
            NORTHWALL,
            SOUTHWALL,
            EASTWALL,
            WESTWALL;

          function preload(){
          var preload = new createjs.LoadQueue(true);
          preload.addEventListener("complete", handleComplete);
          preload.loadManifest([
            {id:"floor", src:"<%= image_path('wood-floor-tile-1.png')%>"},
            {id:"eastwall", src:"<%= image_path('eastwall.png')%>"},
            {id:"westwall", src:"<%= image_path('westwall.png')%>"},
            {id:"northwall", src:"<%= image_path('northwall.png')%>"},
            {id:"southwall", src:"<%= image_path('southwall.png')%>"}
          ]);
            function handleComplete() {
              FLOOR = preload.getResult("floor");
              EASTWALL = preload.getResult("eastwall");
              WESTWALL = preload.getResult("westwall");
              NORTHWALL = preload.getResult("northwall");
              SOUTHWALL = preload.getResult("southwall");
              grid.drawCells(grid, FLOOR, NORTHWALL, SOUTHWALL, EASTWALL, WESTWALL);
            };
          };

          preload();

        var _W = 500
          , _H = 500
          , xCentre = _W/2
          , yCentre = _H/2
          , wWidth = (grid.gridRows+1)*80
          , wHeight = (grid.columns+1)*80;

        var hero = new Hero('Hero 1', 20, 20, wWidth, wHeight, walls);
        world.addChild(hero);

        createjs.Ticker.timingMode = createjs.Ticker.RAF;
        createjs.Ticker.setFPS(60);
        createjs.Ticker.addEventListener("tick", function (event) { 
          stage.update();
          updateBackground();
          cameraMove();
        });

        function cameraMove(){
          if (wWidth > _W) {
            if (hero.x < wWidth - xCentre && hero.x > xCentre)
              world.x = -hero.x + xCentre;
            else if (hero.x >= wWidth - xCentre)
              world.x = -(wWidth - _W);
            else
              world.x = 0;
          }

          if (wHeight > _H) {
            if (hero.y < wHeight - yCentre && hero.y > yCentre)
              world.y = -hero.y + yCentre;
            else if (hero.y >= wHeight - yCentre)
              world.y = -(wHeight - _H);
            else
              world.y = 0;
          }
        };

        function updateBackground() {
          var x = world.x
            , y = world.y;

          canvas.style.backgroundPositionX = x + 'px';
          canvas.style.backgroundPositionY = y + 'px';
        };
      };
