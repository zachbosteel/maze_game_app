'use strict';

var Container = createjs.Container
var EventDispatcher = createjs.EventDispatcher
var EaselEvent = createjs.Event

var Hero = createSubclass(Container, 'Hero', {
  initialize: Hero$initialize
});


function Hero$initialize(name, x, y, wWidth, wHeight) {
  Container.prototype.initialize.apply(this, arguments);
  this.name = name;
  this.x = x;
  this.y = y;
  this.radius = 10;
  this.wWidth = wWidth;
  this.wHeight = wHeight;

  _setupDisplay.call(this);
  _setupProperties.call(this);

  this.on('tick', onTick);
};


function _setupDisplay(){
  this.body = new createjs.Bitmap("<%= image_path('Carbuncle2.gif')%>")
  this.body.x = this.x - 10;
  this.body.y = this.y - 10;
  this.addChild(this.body);
}

function _setupProperties(){
  this.name = 'hero';
  this.inertia = 0;
};

function onTick(event){
  var actions = actionService.get();

  var speed = 5;

  if (actions.moveright) this.x += speed;
  if (actions.moveleft) this.x -= speed;
  if (actions.moveup) this.y -= speed;
  if (actions.movedown) this.y += speed;

  for (var wall = 0; wall < walls.length; wall++){
    var currentWall = walls[wall];
    var intersection = ndgmr.checkPixelCollision(currentWall, this.body)
    if (intersection){
      console.log("collision!");
      if (actions.moveright && currentWall.x + 80 > this.x){ 
        console.log("collision to the right!")
        this.x -= 9; 
        delete actions.moveright
      }
      if (actions.moveleft && currentWall.x < this.x){ 
        console.log("collision to the left!")
        this.x +=9;
        delete actions.moveleft
      };
      if (actions.moveup && currentWall.y < this.y) {
        console.log("collision above!")
        this.y +=9;
        delete actions.moveup
      }
      if (actions.movedown && currentWall.y + 80 > this.y) {
        console.log("collision below!")
        this.y -=9;
        delete actions.movedown
      };
    } 
  }

  if (this.x === this.wWidth - this.width) {
    this.x -= 7;
    actions.moveright = false;
  }
  if (this.x === this.width) {
    this.x +=7;
    actions.moveleft = false;
  }
  if (this.y === this.height) {
    this.y +=7;
    actions.moveup = false;
  }
  if (this.y === this.wHeight - this.height) {
    this.y -=7;
    actions.movedown = false;
  }

  if (this.x < 0 || this.x > this.wWidth){
    this.x = this.x * -1;
  }
  if (this.y < 0 || this.y > this.wHeight){
    this.y = this.y * -1;
  }

}

